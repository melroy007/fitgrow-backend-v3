<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FitGrow - Your Fitness Companion</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #3B82F6;
      --primary-dark: #2563EB;
      --bg: #000000;
      --card: #0A0A0A;
      --light: #1A1A1A;
      --text: #FFFFFF;
      --muted: #9CA3AF;
      --border: #262626;
      --success: #10B981;
    }
    body { 
      font-family: 'Inter', sans-serif; 
      background: var(--bg); 
      color: var(--text);
      overflow-x: hidden;
    }
    .hidden { display: none !important; }
    .modal { position: fixed; top:0; left:0; width:100%; height:100%; z-index:1000; display:flex; align-items:center; justify-content:center; }
    .overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); }
    .modal-box { position:relative; z-index:1; background:var(--card); border-radius:16px; width:90%; max-width:400px; border:1px solid var(--border); max-height:90vh; overflow-y:auto; }
    .modal-head { padding:20px 24px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; background:var(--card); z-index:1; }
    .modal-head h2 { font-size:20px; font-weight:800; }
    .modal-close { font-size:24px; cursor:pointer; color:var(--muted); background:none; border:none; }
    .modal-body { padding:24px; }
    .input { width:100%; padding:12px 16px; margin-bottom:12px; background:var(--light); border:2px solid var(--border); border-radius:8px; color:var(--text); font-size:15px; font-family:inherit; transition:border 0.3s; }
    .input:focus { outline:none; border-color:var(--primary); }
    .err { background:rgba(239,68,68,0.1); border:1px solid #ef4444; color:#ef4444; padding:10px; border-radius:8px; margin-bottom:12px; font-size:13px; }
    .toggle-text { text-align:center; margin-top:12px; color:var(--muted); font-size:13px; }
    .toggle-text a { color:var(--primary); text-decoration:none; font-weight:700; margin-left:5px; }
    .app { display:flex; min-height:100vh; }
    .sidebar { width:240px; background:var(--card); border-right:1px solid var(--border); padding:20px 16px; display:flex; flex-direction:column; gap:16px; position:fixed; height:100vh; overflow-y:auto; z-index:100; }
    .logo { display:flex; align-items:center; gap:10px; padding-bottom:16px; border-bottom:1px solid var(--border); }
    .logo span:first-child { font-size:24px; }
    .logo span:last-child { font-size:18px; font-weight:800; color:var(--primary); }
    .user-box { display:flex; align-items:center; gap:10px; padding:12px; background:var(--light); border-radius:10px; }
    .avatar { width:36px; height:36px; background:var(--primary); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:16px; }
    .user-name { font-weight:700; font-size:13px; }
    .user-status { font-size:11px; }
    .status-online { color:#10B981; }
    .status-offline { color:#F59E0B; }
    .nav { flex:1; display:flex; flex-direction:column; gap:4px; }
    .nav-btn { display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:600; font-size:13px; color:var(--muted); border:none; background:none; width:100%; text-align:left; transition:all 0.2s; }
    .nav-btn:hover { background:var(--light); color:var(--text); }
    .nav-btn.active { background:var(--primary); color:#fff; }
    .nav-icon { font-size:16px; }
    .sidebar-foot { border-top:1px solid var(--border); padding-top:14px; display:flex; flex-direction:column; gap:8px; }
    .main { flex:1; margin-left:240px; padding:24px 20px; overflow-y:auto; position:relative; }
    .page { display:none; animation:fadeUp 0.3s; }
    .page.active { display:block; }
    @keyframes fadeUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    .page-head { margin-bottom:24px; display:flex; justify-content:space-between; align-items:flex-start; }
    .page-head h1 { font-size:28px; font-weight:800; margin-bottom:6px; }
    .page-head p { color:var(--muted); font-size:14px; }
    .stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px; margin-bottom:24px; }
    .stat { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:18px; cursor:pointer; transition:all 0.3s; }
    .stat:hover { border-color:var(--primary); transform:translateY(-2px); }
    .stat-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .stat-ico { width:42px; height:42px; background:var(--light); border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; }
    .badge { background:rgba(59,130,246,0.15); color:var(--primary); padding:4px 8px; border-radius:16px; font-size:10px; font-weight:700; }
    .stat-label { font-size:10px; font-weight:700; color:var(--muted); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; }
    .stat-val { font-size:32px; font-weight:800; margin-bottom:4px; transition:transform 0.2s; }
    .stat-goal { font-size:11px; color:var(--muted); margin-bottom:10px; }
    .prog { height:5px; background:var(--light); border-radius:10px; margin-bottom:10px; overflow:hidden; }
    .prog-bar { height:100%; background:var(--primary); border-radius:10px; transition:width 0.5s; width:0%; }
    .add-btn { padding:7px 14px; background:var(--primary); border:none; border-radius:7px; color:#fff; font-weight:700; font-size:11px; cursor:pointer; opacity:0; transition:all 0.2s; }
    .stat:hover .add-btn { opacity:1; }
    .add-btn:hover { background:var(--primary-dark); }
    .action-card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:18px; margin-bottom:16px; }
    .action-card h3 { font-size:16px; font-weight:800; margin-bottom:14px; }
    .actions { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:10px; }
    .act-btn { padding:14px; border:none; border-radius:10px; background:var(--primary); color:#fff; font-weight:700; font-size:13px; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:6px; transition:all 0.2s; }
    .act-btn:hover { background:var(--primary-dark); transform:translateY(-2px); }
    .act-btn.grey { background:var(--light); }
    .act-btn.grey:hover { background:#262626; }
    .act-ico { font-size:24px; }
    .workout-list { display:flex; flex-direction:column; gap:10px; }
    .workout-item { background:var(--card); border:1px solid var(--border); border-radius:10px; padding:14px; display:flex; align-items:center; gap:12px; transition:all 0.2s; }
    .workout-item:hover { border-color:var(--primary); }
    .workout-item.completed { opacity:0.6; border-color:var(--success); }
    .workout-checkbox { width:20px; height:20px; border:2px solid var(--border); border-radius:6px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.2s; flex-shrink:0; }
    .workout-checkbox.checked { background:var(--success); border-color:var(--success); }
    .workout-checkbox.checked::after { content:'‚úì'; color:#fff; font-size:14px; font-weight:800; }
    .workout-info { flex:1; }
    .workout-name { font-size:15px; font-weight:700; margin-bottom:4px; }
    .workout-details { font-size:12px; color:var(--muted); }
    .workout-day { font-size:11px; color:var(--primary); background:rgba(59,130,246,0.15); padding:4px 8px; border-radius:12px; display:inline-block; margin-top:4px; }
    .workout-delete { padding:6px 12px; background:rgba(239,68,68,0.15); border:none; border-radius:6px; color:#ef4444; font-size:11px; font-weight:700; cursor:pointer; }
    .workout-delete:hover { background:rgba(239,68,68,0.3); }
    .history-list { display:flex; flex-direction:column; gap:10px; }
    .history-item { background:var(--card); border:1px solid var(--border); border-radius:10px; padding:14px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s; }
    .history-item:hover { border-color:var(--primary); }
    .history-info { flex:1; }
    .history-name { font-size:14px; font-weight:700; margin-bottom:4px; }
    .history-details { font-size:12px; color:var(--muted); }
    .history-time { font-size:11px; color:var(--muted); margin-top:4px; }
    .history-stats { display:flex; gap:14px; }
    .history-stat { text-align:center; }
    .history-stat-val { font-size:16px; font-weight:800; color:var(--primary); }
    .history-stat-label { font-size:10px; color:var(--muted); text-transform:uppercase; }
    .sync-status { position:fixed; bottom:20px; right:20px; background:var(--card); border:1px solid var(--border); border-radius:10px; padding:10px 16px; display:flex; align-items:center; gap:8px; font-size:12px; font-weight:600; z-index:50; box-shadow:0 4px 12px rgba(0,0,0,0.5); }
    .sync-indicator { width:7px; height:7px; border-radius:50%; }
    .sync-online { background:#10B981; animation:pulse 2s infinite; }
    .sync-offline { background:#F59E0B; }
    @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }
    .btn { padding:10px 20px; border:none; border-radius:8px; font-weight:700; font-size:13px; cursor:pointer; transition:all 0.2s; display:inline-flex; align-items:center; gap:6px; font-family:inherit; }
    .btn-primary { background:var(--primary); color:#fff; }
    .btn-primary:hover { background:var(--primary-dark); }
    .btn-outline { background:var(--light); color:var(--text); border:1px solid var(--border); }
    .btn-outline:hover { background:var(--primary); border-color:var(--primary); color:#fff; }
    .btn-full { width:100%; justify-content:center; }
    .btn-danger { background:#EF4444; color:#fff; }
    .btn-danger:hover { background:#DC2626; }
    select.input { cursor:pointer; }
    .settings-card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:20px; max-width:460px; }
    .settings-card h3 { font-size:16px; font-weight:800; margin-bottom:16px; }
    .form-group { margin-bottom:14px; }
    .form-group label { display:block; font-size:11px; font-weight:700; color:var(--muted); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; }
    .empty-state { text-align:center; padding:30px; color:var(--muted); }
    .empty-state-icon { font-size:40px; margin-bottom:10px; }
    @media(max-width:768px) {
      .app { flex-direction:column; }
      .sidebar { width:100%; height:auto; position:relative; border-right:none; border-bottom:1px solid var(--border); padding:16px; }
      .main { margin-left:0; padding:16px; }
      .stats { grid-template-columns:1fr; gap:12px; }
      .stat { padding:16px; }
      .stat-val { font-size:28px; }
      .actions { grid-template-columns:1fr 1fr; }
      .page-head { flex-direction:column; gap:12px; }
      .page-head h1 { font-size:24px; }
      .history-item { flex-direction:column; align-items:flex-start; gap:12px; }
      .history-stats { width:100%; justify-content:space-around; }
      .sync-status { bottom:10px; right:10px; font-size:11px; padding:8px 12px; }
    }
  </style>
</head>
<body>

<div id="authModal" class="modal hidden">
  <div class="overlay" onclick="closeAuth()"></div>
  <div class="modal-box">
    <div class="modal-head">
      <h2 id="authTitle">Login</h2>
      <button class="modal-close" onclick="closeAuth()">√ó</button>
    </div>
    <div class="modal-body">
      <input type="text" id="authUsername" class="input hidden" placeholder="Username">
      <input type="email" id="authEmail" class="input" placeholder="Email">
      <input type="password" id="authPassword" class="input" placeholder="Password">
      <div id="authError" class="err hidden"></div>
      <button id="authSubmitBtn" class="btn btn-primary btn-full" onclick="login()">Login</button>
      <p class="toggle-text">
        <span id="toggleText">Don't have an account?</span>
        <a href="#" onclick="toggleMode(event)">Sign Up</a>
      </p>
      <p class="toggle-text" style="margin-top:8px;">
        <a href="#" onclick="continueAsGuest()">Continue as Guest</a>
      </p>
    </div>
  </div>
</div>

<div id="addWorkoutModal" class="modal hidden">
  <div class="overlay" onclick="closeWorkoutModal()"></div>
  <div class="modal-box">
    <div class="modal-head">
      <h2>Add Workout</h2>
      <button class="modal-close" onclick="closeWorkoutModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-group"><label>Exercise Name</label><input type="text" id="workoutName" class="input" placeholder="e.g., Push-ups"></div>
      <div class="form-group"><label>Sets</label><input type="number" id="workoutSets" class="input" placeholder="3"></div>
      <div class="form-group"><label>Reps</label><input type="number" id="workoutReps" class="input" placeholder="12"></div>
      <div class="form-group"><label>Duration (min)</label><input type="number" id="workoutDuration" class="input" placeholder="30"></div>
      <div class="form-group">
        <label>Day</label>
        <select id="workoutDay" class="input">
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
          <option value="Friday">Friday</option>
          <option value="Saturday">Saturday</option>
          <option value="Sunday">Sunday</option>
          <option value="Everyday">Everyday</option>
        </select>
      </div>
      <button class="btn btn-primary btn-full" onclick="saveWorkout()">‚úÖ Add Workout</button>
    </div>
  </div>
</div>

<div id="mainApp" class="app">
  <aside class="sidebar">
    <div class="logo"><span>üí™</span><span>FitGrow</span></div>
    <div class="user-box">
      <div class="avatar">üë§</div>
      <div>
        <div class="user-name" id="userName">Guest</div>
        <div class="user-status" id="userStatus">
          <span class="status-offline">‚óè Offline</span>
        </div>
      </div>
    </div>
    <nav class="nav">
      <button class="nav-btn active" onclick="go('dashboard',this)"><span class="nav-icon">üìä</span>Dashboard</button>
      <button class="nav-btn" onclick="go('scanner',this)"><span class="nav-icon">üì∏</span>Food Scanner</button>
      <button class="nav-btn" onclick="go('tracker',this)"><span class="nav-icon">üìà</span>Activity Tracker</button>
      <button class="nav-btn" onclick="go('workouts',this)"><span class="nav-icon">üèãÔ∏è</span>Workouts</button>
      <button class="nav-btn" onclick="go('nutrition',this)"><span class="nav-icon">ü•ó</span>Nutrition</button>
      <button class="nav-btn" onclick="go('progress',this)"><span class="nav-icon">üìä</span>Progress</button>
      <button class="nav-btn" onclick="go('settings',this)"><span class="nav-icon">‚öôÔ∏è</span>Settings</button>
    </nav>
    <div class="sidebar-foot">
      <button class="btn btn-primary btn-full" id="syncBtn" onclick="manualSync()">‚òÅÔ∏è Sync</button>
      <button class="btn btn-outline btn-full" id="loginBtn" onclick="showAuth()">üîê Login</button>
      <button class="btn btn-danger btn-full hidden" id="logoutBtn" onclick="doLogout()">üö™ Logout</button>
    </div>
  </aside>

  <main class="main">
    <div id="dashboardPage" class="page active">
      <div class="page-head">
        <div>
          <h1>Welcome back! üî•</h1>
          <p>Your daily nutrition overview</p>
        </div>
      </div>
      <div class="stats">
        <div class="stat" onclick="add('calories')">
          <div class="stat-top"><div class="stat-ico">üî•</div><div class="badge">+100</div></div>
          <div class="stat-label">Calories</div>
          <div class="stat-val" id="calories">0</div>
          <div class="stat-goal">Goal: <span id="goalCalShow">3000</span> kcal</div>
          <div class="prog"><div class="prog-bar" id="calProg"></div></div>
          <button class="add-btn" onclick="event.stopPropagation();add('calories')">+ Add</button>
        </div>
        <div class="stat" onclick="add('protein')">
          <div class="stat-top"><div class="stat-ico">ü•©</div><div class="badge">+10g</div></div>
          <div class="stat-label">Protein</div>
          <div class="stat-val" id="protein">0g</div>
          <div class="stat-goal">Goal: <span id="goalProteinShow">150</span>g</div>
          <div class="prog"><div class="prog-bar" id="proteinProg"></div></div>
          <button class="add-btn" onclick="event.stopPropagation();add('protein')">+ Add</button>
        </div>
        <div class="stat" onclick="add('carbs')">
          <div class="stat-top"><div class="stat-ico">üçû</div><div class="badge">+20g</div></div>
          <div class="stat-label">Carbs</div>
          <div class="stat-val" id="carbs">0g</div>
          <div class="stat-goal">Goal: <span id="goalCarbsShow">250</span>g</div>
          <div class="prog"><div class="prog-bar" id="carbsProg"></div></div>
          <button class="add-btn" onclick="event.stopPropagation();add('carbs')">+ Add</button>
        </div>
        <div class="stat" onclick="add('water')">
          <div class="stat-top"><div class="stat-ico">üíß</div><div class="badge">+0.5L</div></div>
          <div class="stat-label">Water</div>
          <div class="stat-val" id="water">0.0L</div>
          <div class="stat-goal">Goal: <span id="goalWaterShow">2.5</span>L</div>
          <div class="prog"><div class="prog-bar" id="waterProg"></div></div>
          <button class="add-btn" onclick="event.stopPropagation();add('water')">+ Add</button>
        </div>
      </div>
      <div class="action-card">
        <h3>Quick Actions</h3>
        <div class="actions">
          <button class="act-btn" onclick="go('scanner',null)"><span class="act-ico">üì∏</span>Scan Food</button>
          <button class="act-btn" onclick="add('water')"><span class="act-ico">üíß</span>Add Water</button>
          <button class="act-btn" onclick="go('tracker',null)"><span class="act-ico">üìà</span>Activity</button>
          <button class="act-btn grey" onclick="manualReset()"><span class="act-ico">üîÑ</span>Reset</button>
        </div>
      </div>
    </div>

    <div id="trackerPage" class="page">
      <div class="page-head">
        <div>
          <h1>Activity Tracker üìà</h1>
          <p>Track steps, sleep & goals</p>
        </div>
      </div>
      <div class="stats">
        <div class="stat" onclick="add('steps')">
          <div class="stat-top"><div class="stat-ico">üëü</div><div class="badge">+1000</div></div>
          <div class="stat-label">Steps</div>
          <div class="stat-val" id="steps">0</div>
          <div class="stat-goal">Goal: <span id="goalStepsShow">10000</span></div>
          <div class="prog"><div class="prog-bar" id="stepsProg"></div></div>
          <button class="add-btn" onclick="event.stopPropagation();add('steps')">+ Add</button>
        </div>
        <div class="stat" onclick="add('sleep')">
          <div class="stat-top"><div class="stat-ico">üò¥</div><div class="badge">+1hr</div></div>
          <div class="stat-label">Sleep</div>
          <div class="stat-val" id="sleep">0.0h</div>
          <div class="stat-goal">Goal: <span id="goalSleepShow">8</span>h</div>
          <div class="prog"><div class="prog-bar" id="sleepProg"></div></div>
          <button class="add-btn" onclick="event.stopPropagation();add('sleep')">+ Add</button>
        </div>
      </div>
      <div class="settings-card">
        <h3>Daily Goals</h3>
        <div class="form-group"><label>Calories</label><input type="number" id="gCal" class="input" value="3000"></div>
        <div class="form-group"><label>Protein (g)</label><input type="number" id="gProtein" class="input" value="150"></div>
        <div class="form-group"><label>Carbs (g)</label><input type="number" id="gCarbs" class="input" value="250"></div>
        <div class="form-group"><label>Water (L)</label><input type="number" id="gWater" class="input" value="2.5" step="0.1"></div>
        <div class="form-group"><label>Steps</label><input type="number" id="gSteps" class="input" value="10000"></div>
        <div class="form-group"><label>Sleep (hrs)</label><input type="number" id="gSleep" class="input" value="8" step="0.5"></div>
        <button class="btn btn-primary" onclick="saveGoals()">üíæ Save Goals</button>
      </div>
    </div>

    <div id="scannerPage" class="page">
      <div class="page-head">
        <div>
          <h1>Food Scanner üì∏</h1>
          <p>AI-powered nutrition tracking</p>
        </div>
        <button class="btn btn-primary" onclick="scanFood()">üì∑ Scan Food</button>
      </div>
      <div class="action-card">
        <h3>Scan History</h3>
        <div id="scanHistory" class="history-list">
          <div class="empty-state">
            <div class="empty-state-icon">üì∏</div>
            <p>No scans yet</p>
          </div>
        </div>
      </div>
    </div>

    <div id="workoutsPage" class="page">
      <div class="page-head">
        <div>
          <h1>Workouts üèãÔ∏è</h1>
          <p>Your weekly workout plan</p>
        </div>
        <button class="btn btn-primary" onclick="showAddWorkout()">+ Add Workout</button>
      </div>
      <div class="action-card">
        <h3>Today's Workouts (<span id="todayDay">Monday</span>)</h3>
        <div id="todayWorkouts" class="workout-list">
          <div class="empty-state">
            <div class="empty-state-icon">üèãÔ∏è</div>
            <p>No workouts for today</p>
          </div>
        </div>
      </div>
      <div class="action-card">
        <h3>All Workouts</h3>
        <div id="allWorkouts" class="workout-list">
          <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <p>No workouts added yet</p>
          </div>
        </div>
      </div>
    </div>

    <div id="nutritionPage" class="page">
      <div class="page-head">
        <div>
          <h1>Nutrition Log ü•ó</h1>
          <p>All your meals</p>
        </div>
      </div>
      <div class="action-card">
        <h3>Today's Meals</h3>
        <div id="nutritionHistory" class="history-list">
          <div class="empty-state">
            <div class="empty-state-icon">ü•ó</div>
            <p>No meals yet</p>
          </div>
        </div>
      </div>
    </div>

    <div id="progressPage" class="page">
      <div class="page-head">
        <div>
          <h1>Progress üìä</h1>
          <p>Track your journey</p>
        </div>
      </div>
      <div class="action-card" style="text-align:center; padding:40px;">
        <div style="font-size:60px; margin-bottom:16px;">üìä</div>
        <h3>Coming Soon</h3>
        <p style="color:var(--muted); margin-top:8px;">Progress charts in development</p>
      </div>
    </div>

    <div id="settingsPage" class="page">
      <div class="page-head">
        <div>
          <h1>Settings ‚öôÔ∏è</h1>
          <p>App preferences</p>
        </div>
      </div>
      <div class="action-card" style="text-align:center; padding:40px;">
        <div style="font-size:60px; margin-bottom:16px;">‚öôÔ∏è</div>
        <h3>Coming Soon</h3>
        <p style="color:var(--muted); margin-top:8px;">Settings panel in development</p>
      </div>
    </div>
  </main>

  <div class="sync-status">
    <div class="sync-indicator" id="syncIndicator"></div>
    <span id="syncText">Offline</span>
  </div>
</div>

<script>
const API='https://fitgrow-backend-v3.onrender.com/api';let token=localStorage.getItem('token');let user=JSON.parse(localStorage.getItem('user')||'null');let isGuest=!token;const goals=JSON.parse(localStorage.getItem('goals')||'{"calories":3000,"protein":150,"carbs":250,"water":2.5,"steps":10000,"sleep":8}');let autoSyncInterval;let scanHistory=JSON.parse(localStorage.getItem('scanHistory')||'[]');let workouts=JSON.parse(localStorage.getItem('workouts')||'[]');let workoutCompletions=JSON.parse(localStorage.getItem('workoutCompletions')||'{}');checkAutoReset();showAuth();if(token&&user){closeAuth();updateUserUI();startAutoSync()}loadGoalsToUI();renderScanHistory();renderWorkouts();updateTodayDay();function checkAutoReset(){const lastResetDate=localStorage.getItem('lastResetDate');const today=new Date().toDateString();if(lastResetDate!==today){resetDay();workoutCompletions={};localStorage.setItem('workoutCompletions',JSON.stringify(workoutCompletions));localStorage.setItem('lastResetDate',today)}}function updateTodayDay(){const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];const today=days[new Date().getDay()];document.getElementById('todayDay').textContent=today}function updateUserUI(){const userName=document.getElementById('userName');const userStatus=document.getElementById('userStatus');const loginBtn=document.getElementById('loginBtn');const logoutBtn=document.getElementById('logoutBtn');const syncIndicator=document.getElementById('syncIndicator');const syncText=document.getElementById('syncText');if(isGuest){userName.textContent='Guest';userStatus.innerHTML='<span class="status-offline">‚óè Offline</span>';loginBtn.classList.remove('hidden');logoutBtn.classList.add('hidden');syncIndicator.className='sync-indicator sync-offline';syncText.textContent='Offline'}else{userName.textContent=user.username;userStatus.innerHTML='<span class="status-online">‚óè Synced</span>';loginBtn.classList.add('hidden');logoutBtn.classList.remove('hidden');syncIndicator.className='sync-indicator sync-online';syncText.textContent='Auto-sync'}}function startAutoSync(){if(isGuest)return;autoSyncInterval=setInterval(()=>autoSync(),30000)}async function autoSync(){if(isGuest||!token)return;try{const data={calories:parseInt(document.getElementById('calories').textContent)||0};if(data.calories>0){await fetch(`${API}/health/activity`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},body:JSON.stringify({type:'calories',value:data.calories})})}}catch(e){}}async function manualSync(){if(isGuest){alert('‚ö†Ô∏è Login to sync!');return}await autoSync();alert('‚úÖ Synced!')}function go(page,btn){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(page+'Page').classList.add('active');document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');if(page==='workouts')renderWorkouts()}function add(type){const vals={calories:100,protein:10,carbs:20,water:0.5,steps:1000,sleep:1};const progs={calories:'calProg',protein:'proteinProg',carbs:'carbsProg',water:'waterProg',steps:'stepsProg',sleep:'sleepProg'};const el=document.getElementById(type);let v=parseFloat(el.textContent)||0;v+=vals[type];if(type==='water')el.textContent=v.toFixed(1)+'L';else if(type==='sleep')el.textContent=v.toFixed(1)+'h';else if(type==='protein'||type==='carbs')el.textContent=Math.round(v)+'g';else el.textContent=Math.round(v);const pct=Math.min((v/goals[type])*100,100);document.getElementById(progs[type]).style.width=pct+'%';el.style.transform='scale(1.15)';setTimeout(()=>el.style.transform='scale(1)',200);if(!isGuest)setTimeout(autoSync,1000)}function scanFood(){alert('üì∏ Scanning...');setTimeout(()=>{const foods=[{name:'Grilled Chicken',calories:350,protein:45,carbs:0},{name:'Brown Rice',calories:280,protein:6,carbs:58},{name:'Salmon Fillet',calories:420,protein:38,carbs:0},{name:'Protein Shake',calories:180,protein:30,carbs:12}];const mock=foods[Math.floor(Math.random()*foods.length)];document.getElementById('calories').textContent=(parseInt(document.getElementById('calories').textContent)||0)+mock.calories;document.getElementById('protein').textContent=(parseInt(document.getElementById('protein').textContent)||0)+mock.protein+'g';document.getElementById('carbs').textContent=(parseInt(document.getElementById('carbs').textContent)||0)+mock.carbs+'g';['calories','protein','carbs'].forEach(t=>{const v=parseInt(document.getElementById(t).textContent)||0;const pct=Math.min((v/goals[t])*100,100);document.getElementById(t+'Prog').style.width=pct+'%'});const scan={name:mock.name,calories:mock.calories,protein:mock.protein,carbs:mock.carbs,time:new Date().toLocaleString()};scanHistory.unshift(scan);if(scanHistory.length>20)scanHistory.pop();localStorage.setItem('scanHistory',JSON.stringify(scanHistory));renderScanHistory();alert(`‚úÖ ${mock.name}\n\n+${mock.calories} cal ‚Ä¢ +${mock.protein}g protein ‚Ä¢ +${mock.carbs}g carbs`);if(!isGuest)autoSync()},1500)}function renderScanHistory(){const container=document.getElementById('scanHistory');const nutritionContainer=document.getElementById('nutritionHistory');if(scanHistory.length===0){container.innerHTML='<div class="empty-state"><div class="empty-state-icon">üì∏</div><p>No scans yet</p></div>';nutritionContainer.innerHTML='<div class="empty-state"><div class="empty-state-icon">ü•ó</div><p>No meals yet</p></div>';return}const html=scanHistory.map(item=>`<div class="history-item"><div class="history-info"><div class="history-name">${item.name}</div><div class="history-details">${item.calories} cal ‚Ä¢ ${item.protein}g protein ‚Ä¢ ${item.carbs}g carbs</div><div class="history-time">${item.time}</div></div><div class="history-stats"><div class="history-stat"><div class="history-stat-val">${item.calories}</div><div class="history-stat-label">Cal</div></div><div class="history-stat"><div class="history-stat-val">${item.protein}g</div><div class="history-stat-label">Protein</div></div></div></div>`).join('');container.innerHTML=html;nutritionContainer.innerHTML=html}function showAddWorkout(){document.getElementById('addWorkoutModal').classList.remove('hidden');const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];const today=days[new Date().getDay()];document.getElementById('workoutDay').value=today}function closeWorkoutModal(){document.getElementById('addWorkoutModal').classList.add('hidden');document.getElementById('workoutName').value='';document.getElementById('workoutSets').value='';document.getElementById('workoutReps').value='';document.getElementById('workoutDuration').value=''}function saveWorkout(){const name=document.getElementById('workoutName').value;const sets=document.getElementById('workoutSets').value;const reps=document.getElementById('workoutReps').value;const duration=document.getElementById('workoutDuration').value;const day=document.getElementById('workoutDay').value;if(!name){alert('‚ö†Ô∏è Please enter exercise name');return}const workout={id:Date.now(),name,sets:sets||null,reps:reps||null,duration:duration||null,day};workouts.push(workout);localStorage.setItem('workouts',JSON.stringify(workouts));renderWorkouts();closeWorkoutModal();alert(`‚úÖ ${name} added to ${day}!`)}function toggleWorkout(id){const today=new Date().toDateString();if(!workoutCompletions[today])workoutCompletions[today]={};workoutCompletions[today][id]=!workoutCompletions[today][id];localStorage.setItem('workoutCompletions',JSON.stringify(workoutCompletions));renderWorkouts()}function deleteWorkout(id){if(!confirm('Delete this workout?'))return;workouts=workouts.filter(w=>w.id!==id);localStorage.setItem('workouts',JSON.stringify(workouts));renderWorkouts()}function renderWorkouts(){const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];const today=days[new Date().getDay()];const todayDate=new Date().toDateString();const todayWorkouts=workouts.filter(w=>w.day===today||w.day==='Everyday');const todayContainer=document.getElementById('todayWorkouts');if(todayWorkouts.length===0){todayContainer.innerHTML='<div class="empty-state"><div class="empty-state-icon">üèãÔ∏è</div><p>No workouts for today</p></div>'}else{todayContainer.innerHTML=todayWorkouts.map(w=>{const completed=workoutCompletions[todayDate]?.[w.id]||false;let details='';if(w.sets&&w.reps)details=`${w.sets} sets √ó ${w.reps} reps`;else if(w.duration)details=`${w.duration} min`;return`<div class="workout-item ${completed?'completed':''}"><div class="workout-checkbox ${completed?'checked':''}" onclick="toggleWorkout(${w.id})"></div><div class="workout-info"><div class="workout-name">${w.name}</div>${details?`<div class="workout-details">${details}</div>`:''}</div></div>`}).join('')}const allContainer=document.getElementById('allWorkouts');if(workouts.length===0){allContainer.innerHTML='<div class="empty-state"><div class="empty-state-icon">üìã</div><p>No workouts yet</p></div>'}else{allContainer.innerHTML=workouts.map(w=>{let details='';if(w.sets&&w.reps)details=`${w.sets} sets √ó ${w.reps} reps`;else if(w.duration)details=`${w.duration} min`;return`<div class="workout-item"><div class="workout-info"><div class="workout-name">${w.name}</div>${details?`<div class="workout-details">${details}</div>`:''}<div class="workout-day">${w.day}</div></div><button class="workout-delete" onclick="deleteWorkout(${w.id})">Delete</button></div>`}).join('')}}function resetDay(){['calories','steps'].forEach(t=>document.getElementById(t).textContent='0');['protein','carbs'].forEach(t=>document.getElementById(t).textContent='0g');['water'].forEach(t=>document.getElementById(t).textContent='0.0L');['sleep'].forEach(t=>document.getElementById(t).textContent='0.0h');['calProg','proteinProg','carbsProg','waterProg','stepsProg','sleepProg'].forEach(id=>document.getElementById(id).style.width='0%');if(!isGuest)autoSync()}function manualReset(){if(!confirm('Reset today\'s data?'))return;resetDay();alert('‚úÖ Reset! Auto-resets daily at midnight.')}function saveGoals(){goals.calories=parseInt(document.getElementById('gCal').value)||3000;goals.protein=parseInt(document.getElementById('gProtein').value)||150;goals.carbs=parseInt(document.getElementById('gCarbs').value)||250;goals.water=parseFloat(document.getElementById('gWater').value)||2.5;goals.steps=parseInt(document.getElementById('gSteps').value)||10000;goals.sleep=parseFloat(document.getElementById('gSleep').value)||8;localStorage.setItem('goals',JSON.stringify(goals));updateGoalsDisplay();alert('‚úÖ Goals saved!')}function loadGoalsToUI(){document.getElementById('gCal').value=goals.calories;document.getElementById('gProtein').value=goals.protein;document.getElementById('gCarbs').value=goals.carbs;document.getElementById('gWater').value=goals.water;document.getElementById('gSteps').value=goals.steps;document.getElementById('gSleep').value=goals.sleep;updateGoalsDisplay()}function updateGoalsDisplay(){document.getElementById('goalCalShow').textContent=goals.calories;document.getElementById('goalProteinShow').textContent=goals.protein;document.getElementById('goalCarbsShow').textContent=goals.carbs;document.getElementById('goalWaterShow').textContent=goals.water;document.getElementById('goalStepsShow').textContent=goals.steps;document.getElementById('goalSleepShow').textContent=goals.sleep}function showAuth(){document.getElementById('authModal').classList.remove('hidden')}function closeAuth(){document.getElementById('authModal').classList.add('hidden');document.getElementById('authError').classList.add('hidden')}function continueAsGuest(){isGuest=true;closeAuth();updateUserUI();alert('‚úÖ Welcome Guest!')}function toggleMode(e){e.preventDefault();const title=document.getElementById('authTitle');const btn=document.getElementById('authSubmitBtn');const txt=document.getElementById('toggleText');const un=document.getElementById('authUsername');if(title.textContent==='Login'){title.textContent='Sign Up';btn.textContent='Sign Up';btn.onclick=signup;txt.textContent='Already have an account?';un.classList.remove('hidden')}else{title.textContent='Login';btn.textContent='Login';btn.onclick=login;txt.textContent="Don't have an account?";un.classList.add('hidden')}}function showErr(msg){const el=document.getElementById('authError');el.textContent=msg;el.classList.remove('hidden')}async function login(){const email=document.getElementById('authEmail').value;const pass=document.getElementById('authPassword').value;if(!email||!pass){showErr('Fill all fields');return}try{const r=await fetch(`${API}/auth/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password:pass})});const d=await r.json();if(d.success){token=d.token;user=d.user;isGuest=false;localStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(user));closeAuth();updateUserUI();startAutoSync();alert('‚úÖ Welcome '+user.username+'!')}else showErr(d.message||'Login failed')}catch(e){showErr('Network error')}}async function signup(){const username=document.getElementById('authUsername').value;const email=document.getElementById('authEmail').value;const pass=document.getElementById('authPassword').value;if(!username||!email||!pass){showErr('Fill all fields');return}try{const r=await fetch(`${API}/auth/signup`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,email,password:pass})});const d=await r.json();if(d.success){token=d.token;user=d.user;isGuest=false;localStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(user));closeAuth();updateUserUI();startAutoSync();alert('‚úÖ Welcome!')}else showErr(d.message||'Signup failed')}catch(e){showErr('Network error')}}function doLogout(){if(!confirm('Logout?'))return;if(autoSyncInterval)clearInterval(autoSyncInterval);token=null;user=null;isGuest=true;localStorage.removeItem('token');localStorage.removeItem('user');updateUserUI();alert('‚úÖ Logged out!')}
</script>
</body>
</html>